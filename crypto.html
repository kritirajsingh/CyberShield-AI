{% extends "base.html" %}
{% block title %}Crypto Security Analyzer{% endblock %}

{% block content %}
<div class="crypto-container">
  <!-- Header Section -->
  <div class="crypto-header text-center mb-5">
    <div class="header-content">
      <h1 class="main-title">üí∞ Crypto Security Analyzer</h1>
      <p class="subtitle">Advanced blockchain analysis and AI-powered risk assessment for cryptocurrency wallets</p>
      <div class="api-status">
        <span class="status-badge {% if wallet_insights and wallet_insights.real_data %}status-active{% else %}status-simulated{% endif %}">
          {% if wallet_insights and wallet_insights.real_data %}
          üì° Live Blockchain Data ‚Ä¢ {% if wallet_insights.chain == 'BTC' %}Blockchain.com{% else %}Etherscan{% endif %} API
          {% else %}
          ‚ÑπÔ∏è Simulated Analysis ‚Ä¢ Add API Key for Live Data
          {% endif %}
        </span>
        {% if ml_available %}
        <span class="status-badge ml-status">
          ü§ñ ML Enhanced ‚Ä¢ XGBoost (98.89% Accuracy)
        </span>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="crypto-content-grid">
    <!-- Main Content -->
    <div class="main-content">
      <!-- Scanner Card -->
      <div class="feature-card scanner-card">
        <div class="card-header">
          <div class="card-icon">
            <i class="fas fa-search"></i>
          </div>
          <div class="card-title">
            <h3>Wallet Security Scan</h3>
            <p>Analyze wallet activity patterns and detect potential risks with AI/ML enhancement</p>
          </div>
        </div>

        <form method="POST" class="scanner-form">
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label">üîë Wallet Address</label>
              <input type="text" name="wallet_id" class="form-control" 
                     placeholder="0x1a2b3c4d5e6f7g8h9i0j or 1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa" required>
              <div class="form-text">Enter full Ethereum or Bitcoin wallet address</div>
            </div>

            <div class="form-group">
              <label class="form-label">‚õìÔ∏è Blockchain Network</label>
              <div class="network-options">
                <label class="network-option">
                  <input type="radio" name="chain" value="ETH" checked>
                  <span class="option-content">
                    <span class="option-title">
                      <i class="fab fa-ethereum me-2"></i>Ethereum
                    </span>
                    <span class="option-desc">ERC-20 tokens & smart contracts</span>
                  </span>
                </label>
                <label class="network-option">
                  <input type="radio" name="chain" value="BTC">
                  <span class="option-content">
                    <span class="option-title">
                      <i class="fab fa-bitcoin me-2"></i>Bitcoin
                    </span>
                    <span class="option-desc">BTC transactions & addresses</span>
                  </span>
                </label>
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">üìù Analysis Notes (Optional)</label>
              <textarea name="notes" class="form-control" rows="2" 
                        placeholder="Add context about this wallet (exchange, personal, etc.)"></textarea>
            </div>
          </div>

          <button type="submit" class="scan-btn">
            <i class="fas fa-shield-alt"></i>
            Start AI Security Analysis
          </button>
        </form>
      </div>

      <!-- Enhanced Analysis Results -->
      {% if wallet_insights %}
      <div class="analysis-results">
        <!-- ML Model Status -->
        {% if ml_available %}
        <div class="feature-card ml-status-card">
          <div class="card-header">
            <div class="card-icon">
              <i class="fas fa-brain"></i>
            </div>
            <div class="card-title">
              <h3>AI/ML Enhanced Analysis</h3>
              <p>XGBoost Model (98.89% Accuracy) - Real-time Risk Prediction</p>
            </div>
            <div class="ml-badge">
              <i class="fas fa-robot"></i>
              ML Active
            </div>
          </div>
          
          <div class="ml-metrics">
            {% if wallet_insights.ml_analysis %}
            <div class="ml-grid">
              <div class="ml-metric">
                <div class="metric-value">{{ wallet_insights.ml_analysis.malicious_probability|format_percentage }}</div>
                <div class="metric-label">Risk Probability</div>
              </div>
              <div class="ml-metric">
                <div class="metric-value">{{ wallet_insights.ml_analysis.confidence|format_percentage }}</div>
                <div class="metric-label">Model Confidence</div>
              </div>
              <div class="ml-metric">
                <div class="metric-value">{{ wallet_insights.ml_analysis.features_used }}</div>
                <div class="metric-label">Features Analyzed</div>
              </div>
            </div>
            {% else %}
            <div class="ml-unavailable">
              <i class="fas fa-exclamation-triangle"></i>
              <span>ML Analysis Unavailable - Using Rule-based Assessment</span>
            </div>
            {% endif %}
          </div>
        </div>
        {% endif %}

        <!-- Real Data Indicators -->
        {% if wallet_insights.real_data %}
        <div class="feature-card real-data-card">
          <div class="card-header">
            <div class="card-icon">
              <i class="fas fa-broadcast-tower"></i>
            </div>
            <div class="card-title">
              <h3>Live Blockchain Analysis</h3>
              <p>Real-time data from {% if wallet_insights.chain == 'BTC' %}Bitcoin{% else %}Ethereum{% endif %} blockchain</p>
            </div>
            <div class="real-data-badge">
              <i class="fas fa-check-circle"></i>
              Live Data
            </div>
          </div>
          
          <div class="real-data-grid">
            <div class="data-item">
              <div class="data-icon">
                <i class="fas fa-coins"></i>
              </div>
              <div class="data-content">
                <div class="data-value">
                  {% if wallet_insights.chain == 'BTC' %}
                    {{ wallet_insights.balance|format_btc if wallet_insights.balance else 'N/A' }}
                  {% else %}
                    {{ wallet_insights.balance|format_eth if wallet_insights.balance else 'N/A' }}
                  {% endif %}
                </div>
                <div class="data-label">Current Balance</div>
              </div>
            </div>
            <div class="data-item">
              <div class="data-icon">
                <i class="fas fa-exchange-alt"></i>
              </div>
              <div class="data-content">
                <div class="data-value">{{ wallet_insights.total_transactions }}</div>
                <div class="data-label">Total Transactions</div>
              </div>
            </div>
            <div class="data-item">
              <div class="data-icon">
                <i class="fas fa-users"></i>
              </div>
              <div class="data-content">
                <div class="data-value">{{ wallet_insights.unique_counterparties }}</div>
                <div class="data-label">Unique Addresses</div>
              </div>
            </div>
            <div class="data-item">
              <div class="data-icon">
                <i class="fas fa-chart-line"></i>
              </div>
              <div class="data-content">
                <div class="data-value">
                  {% if wallet_insights.chain == 'BTC' %}
                    {{ wallet_insights.total_volume|format_btc if wallet_insights.total_volume else 'N/A' }}
                  {% else %}
                    {{ wallet_insights.total_volume|format_eth if wallet_insights.total_volume else 'N/A' }}
                  {% endif %}
                </div>
                <div class="data-label">Total Volume</div>
              </div>
            </div>
          </div>
        </div>
        {% endif %}

        <!-- Risk Assessment -->
        <div class="feature-card risk-card">
          <div class="card-header">
            <div class="card-icon">
              <i class="fas fa-shield-alt"></i>
            </div>
            <div class="card-title">
              <h3>Risk Assessment</h3>
              <p>Comprehensive security evaluation with AI enhancement</p>
            </div>
            <div class="risk-badge risk-{{ wallet_insights.risk_level|lower }}">
              {{ wallet_insights.risk_score }}/10 ‚Ä¢ {{ wallet_insights.risk_level }}
              {% if wallet_insights.ml_analysis %}
              <div class="ml-indicator">AI Enhanced</div>
              {% endif %}
            </div>
          </div>

          <div class="risk-metrics">
            <div class="risk-meter">
              <div class="meter-fill" style="width: {{ wallet_insights.risk_score * 10 }}%"></div>
              <div class="meter-labels">
                <span>Low</span>
                <span>Medium</span>
                <span>High</span>
              </div>
            </div>
            
            <div class="risk-indicators">
              {% if wallet_insights.flagged %}
              <div class="indicator danger">
                <i class="fas fa-exclamation-triangle"></i>
                <span>Wallet Flagged for Review</span>
                {% if wallet_insights.ml_analysis and wallet_insights.ml_analysis.flagged_ml %}
                <span class="ml-flag">(AI Detected)</span>
                {% endif %}
              </div>
              {% else %}
              <div class="indicator safe">
                <i class="fas fa-check-circle"></i>
                <span>No Immediate Concerns</span>
                {% if wallet_insights.ml_analysis %}
                <span class="ml-confirm">(AI Confirmed)</span>
                {% endif %}
              </div>
              {% endif %}
            </div>
          </div>
        </div>

        <!-- ML Feature Importance -->
        {% if wallet_insights.ml_analysis and feature_importance %}
        <div class="feature-card ml-insights-card">
          <div class="card-header">
            <div class="card-icon">
              <i class="fas fa-chart-pie"></i>
            </div>
            <div class="card-title">
              <h3>AI Feature Importance</h3>
              <p>What factors influenced the risk assessment</p>
            </div>
          </div>
          
          <div class="feature-importance">
            {% for feature, importance in feature_importance.items() %}
            <div class="feature-item">
              <div class="feature-name">{{ feature.replace('_', ' ').title() }}</div>
              <div class="feature-bar">
                <div class="feature-fill" style="width: {{ importance * 100 }}%"></div>
              </div>
              <div class="feature-value">{{ (importance * 100)|round(1) }}%</div>
            </div>
            {% endfor %}
          </div>
        </div>
        {% endif %}

        <!-- Activity Trends -->
        <div class="feature-card trends-card">
          <div class="card-header">
            <div class="card-icon">
              <i class="fas fa-chart-bar"></i>
            </div>
            <div class="card-title">
              <h3>Activity Trends & Patterns</h3>
              <p>Behavioral analysis and network insights</p>
            </div>
          </div>

          <div class="trends-grid">
            <div class="trend-item">
              <div class="trend-icon">
                {{ wallet_insights.activity_trends.volume_trend.split(' ')[0] }}
              </div>
              <div class="trend-content">
                <div class="trend-title">Volume Trend</div>
                <div class="trend-value">{{ wallet_insights.activity_trends.volume_trend }}</div>
              </div>
            </div>
            <div class="trend-item">
              <div class="trend-icon">
                {{ wallet_insights.activity_trends.frequency_trend.split(' ')[0] }}
              </div>
              <div class="trend-content">
                <div class="trend-title">Frequency Trend</div>
                <div class="trend-value">{{ wallet_insights.activity_trends.frequency_trend }}</div>
              </div>
            </div>
            <div class="trend-item">
              <div class="trend-icon">
                {{ wallet_insights.activity_trends.counterparty_diversity.split(' ')[0] }}
              </div>
              <div class="trend-content">
                <div class="trend-title">Network Diversity</div>
                <div class="trend-value">{{ wallet_insights.activity_trends.counterparty_diversity }}</div>
              </div>
            </div>
            {% if wallet_insights.real_data %}
            <div class="trend-item">
              <div class="trend-icon">
                {{ wallet_insights.activity_trends.balance_status.split(' ')[0] }}
              </div>
              <div class="trend-content">
                <div class="trend-title">Balance Status</div>
                <div class="trend-value">{{ wallet_insights.activity_trends.balance_status }}</div>
              </div>
            </div>
            {% endif %}
          </div>

          {% if wallet_insights.deviations_detected %}
          <div class="deviations-section">
            <div class="deviations-header">
              <i class="fas fa-exclamation-triangle"></i>
              <span>Behavioral Deviations Detected</span>
            </div>
            <div class="deviations-list">
              {% for deviation in wallet_insights.deviations_detected %}
              <div class="deviation-item">
                <i class="fas fa-circle"></i>
                <span>{{ deviation }}</span>
              </div>
              {% endfor %}
            </div>
          </div>
          {% endif %}
        </div>

        <!-- Recommendations -->
        <div class="feature-card recommendations-card">
          <div class="card-header">
            <div class="card-icon">
              <i class="fas fa-lightbulb"></i>
            </div>
            <div class="card-title">
              <h3>Security Recommendations</h3>
              <p>Actionable insights for wallet security</p>
            </div>
          </div>

          <div class="recommendations-list">
            {% for recommendation in wallet_insights.recommendations %}
            <div class="recommendation-item">
              <div class="recommendation-icon">
                {% if 'üö®' in recommendation or 'High risk' in recommendation %}
                <i class="fas fa-exclamation-circle text-danger"></i>
                {% elif '‚ö†Ô∏è' in recommendation or 'Moderate' in recommendation %}
                <i class="fas fa-exclamation-triangle text-warning"></i>
                {% elif 'ü§ñ' in recommendation %}
                <i class="fas fa-robot text-info"></i>
                {% else %}
                <i class="fas fa-check-circle text-success"></i>
                {% endif %}
              </div>
              <div class="recommendation-content">
                {{ recommendation }}
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
      {% endif %}

      <!-- Comparative Risk Map -->
      {% if risk_map %}
      <div class="feature-card comparison-card">
        <div class="card-header">
          <div class="card-icon">
            <i class="fas fa-map-marked-alt"></i>
          </div>
          <div class="card-title">
            <h3>Comparative Risk Analysis</h3>
            <p>Multi-wallet risk assessment overview</p>
          </div>
          <div class="comparison-badge">
            {{ risk_map|length }} Wallets
          </div>
        </div>

        <div class="comparison-grid">
          {% for address, data in risk_map.items() %}
          <div class="wallet-card {% if data.risk_level == 'High' %}risk-high{% elif data.risk_level == 'Medium' %}risk-medium{% else %}risk-low{% endif %}">
            <div class="wallet-header">
              <div class="wallet-address">
                <code>{{ address[:8] }}...{{ address[-6:] }}</code>
                {% if data.real_data %}
                <span class="real-badge">Live</span>
                {% endif %}
                {% if data.ml_analysis %}
                <span class="ml-badge-small">AI</span>
                {% endif %}
              </div>
              <div class="wallet-risk">
                <span class="risk-score">{{ data.risk_score }}/10</span>
                <span class="risk-level {{ data.risk_level|lower }}">{{ data.risk_level }}</span>
              </div>
            </div>
            <div class="wallet-stats">
              <div class="stat">
                <span class="stat-label">Transactions</span>
                <span class="stat-value">{{ data.transaction_count }}</span>
              </div>
              {% if data.real_data %}
              <div class="stat">
                <span class="stat-label">Balance</span>
                <span class="stat-value">
                  {% if data.chain == 'BTC' %}
                    {{ data.balance|format_btc if data.balance else 'N/A' }}
                  {% else %}
                    {{ data.balance|format_eth if data.balance else 'N/A' }}
                  {% endif %}
                </span>
              </div>
              <div class="stat">
                <span class="stat-label">Counterparties</span>
                <span class="stat-value">{{ data.unique_counterparties }}</span>
              </div>
              {% else %}
              <div class="stat">
                <span class="stat-label">Volume</span>
                <span class="stat-value">${{ data.daily_volume|format_number }}</span>
              </div>
              <div class="stat">
                <span class="stat-label">Deviations</span>
                <span class="stat-value {% if data.deviations %}text-danger{% else %}text-success{% endif %}">
                  {{ data.deviations|length if data.deviations else 0 }}
                </span>
              </div>
              {% endif %}
            </div>
            {% if data.ml_analysis %}
            <div class="wallet-ml">
              <div class="ml-confidence">
                <span class="confidence-label">AI Confidence:</span>
                <span class="confidence-value">{{ (data.ml_analysis.confidence * 100)|round(1) }}%</span>
              </div>
            </div>
            {% endif %}
          </div>
          {% endfor %}
        </div>
      </div>
      {% endif %}
    </div>

    <!-- Sidebar -->
    <div class="sidebar">
      <!-- Quick Actions -->
      <div class="sidebar-card actions-card">
        <div class="sidebar-header">
          <i class="fas fa-rocket"></i>
          <h4>Quick Actions</h4>
        </div>
        <div class="actions-list">
          <a href="{{ url_for('dashboard') }}" class="action-btn primary">
            <i class="fas fa-home"></i>
            Back to Dashboard
          </a>
          <a href="{{ url_for('credentials') }}" class="action-btn secondary">
            <i class="fas fa-shield-alt"></i>
            Credential Scan
          </a>
          <a href="{{ url_for('ai_password') }}" class="action-btn secondary">
            <i class="fas fa-robot"></i>
            AI Password Tools
          </a>
        </div>
      </div>

      <!-- ML Status Card -->
      {% if ml_available %}
      <div class="sidebar-card ml-status-sidebar">
        <div class="sidebar-header">
          <i class="fas fa-brain"></i>
          <h4>AI Analysis Status</h4>
        </div>
        <div class="ml-status-content">
          <div class="status-item success">
            <i class="fas fa-check-circle"></i>
            <span>XGBoost Model Loaded</span>
          </div>
          <div class="status-item success">
            <i class="fas fa-chart-line"></i>
            <span>98.89% Accuracy</span>
          </div>
          <div class="status-item info">
            <i class="fas fa-cogs"></i>
            <span>{{ feature_importance|length }} Features</span>
          </div>
        </div>
      </div>
      {% endif %}

      <!-- Previous Checks -->
      {% if checks %}
      <div class="sidebar-card checks-card">
        <div class="sidebar-header">
          <i class="fas fa-history"></i>
          <h4>Recent Scans</h4>
        </div>
        <div class="checks-list">
          {% for check in checks[:5] %}
          <div class="check-item">
            <div class="check-wallet">
              <code>{{ check.wallet_id[:6] }}...{{ check.wallet_id[-4:] }}</code>
              <span class="check-chain">{{ check.chain }}</span>
            </div>
            <div class="check-status">
              <span class="risk-badge risk-{{ check.risk_level|lower }}">
                {{ check.risk_level }}
              </span>
              {% if check.flagged %}
              <i class="fas fa-flag text-danger"></i>
              {% endif %}
            </div>
          </div>
          {% endfor %}
        </div>
        <div class="checks-footer">
          <small class="text-muted">{{ checks|length }} total scans</small>
        </div>
      </div>
      {% endif %}

      <!-- Security Tips -->
      <div class="sidebar-card tips-card">
        <div class="sidebar-header">
          <i class="fas fa-lightbulb"></i>
          <h4>Crypto Security Tips</h4>
        </div>
        <div class="tips-list">
          <div class="tip-item">
            <div class="tip-icon">
              <i class="fas fa-wallet"></i>
            </div>
            <div class="tip-content">
              <strong>Use Hardware Wallets</strong>
              <p>Store large amounts in cold storage</p>
            </div>
          </div>
          <div class="tip-item">
            <div class="tip-icon">
              <i class="fas fa-key"></i>
            </div>
            <div class="tip-content">
              <strong>Secure Private Keys</strong>
              <p>Never share or store digitally</p>
            </div>
          </div>
          <div class="tip-item">
            <div class="tip-icon">
              <i class="fas fa-exchange-alt"></i>
            </div>
            <div class="tip-content">
              <strong>Verify Addresses</strong>
              <p>Always double-check before sending</p>
            </div>
          </div>
          <div class="tip-item">
            <div class="tip-icon">
              <i class="fas fa-robot"></i>
            </div>
            <div class="tip-content">
              <strong>AI Monitoring</strong>
              <p>Use ML models for risk detection</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Previous Checks Table with Delete Functionality -->
  {% if checks %}
  <div class="feature-card history-card mt-4">
    <div class="card-header">
      <div class="card-icon">
        <i class="fas fa-list-alt"></i>
      </div>
      <div class="card-title">
        <h3>Wallet Scan History</h3>
        <p>Complete record of your security analyses</p>
      </div>
      <div class="history-actions">
        <form method="POST" action="{{ url_for('delete_wallet_history') }}" class="d-inline" onsubmit="return confirm('Are you sure you want to delete ALL wallet scan history? This action cannot be undone.');">
          <input type="hidden" name="action" value="delete_all">
          <button type="submit" class="btn btn-danger btn-sm">
            <i class="fas fa-trash"></i> Delete All
          </button>
        </form>
      </div>
    </div>

    <div class="table-container">
      <table class="modern-table">
        <thead>
          <tr>
            <th>Wallet Address</th>
            <th>Network</th>
            <th>Risk Level</th>
            <th>Status</th>
            <th>Notes</th>
            <th>Date</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for check in checks %}
          <tr>
            <td>
              <div class="wallet-cell">
                <code>{{ check.wallet_id[:10] }}...{{ check.wallet_id[-8:] }}</code>
              </div>
            </td>
            <td>
              <span class="network-badge">{{ check.chain }}</span>
            </td>
            <td>
              <span class="risk-badge risk-{{ check.risk_level|lower }}">
                {{ check.risk_level }}
              </span>
            </td>
            <td>
              {% if check.flagged %}
              <span class="status-flagged">
                <i class="fas fa-flag"></i>
                Flagged
              </span>
              {% else %}
              <span class="status-clean">
                <i class="fas fa-check"></i>
                Clean
              </span>
              {% endif %}
            </td>
            <td>
              <span class="notes-text">{{ check.notes or "-" }}</span>
            </td>
            <td>
              <span class="date-text">{{ check.created_at }}</span>
            </td>
            <td>
              <form method="POST" action="{{ url_for('delete_wallet_history') }}" class="d-inline" onsubmit="return confirm('Are you sure you want to delete this wallet scan?');">
                <input type="hidden" name="action" value="delete_single">
                <input type="hidden" name="check_id" value="{{ check.id }}">
                <button type="submit" class="btn btn-outline-danger btn-sm" title="Delete this scan">
                  <i class="fas fa-trash"></i>
                </button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  {% endif %}
</div>

<style>
.crypto-container {
  max-width: 1400px;
  margin: 0 auto;
  padding: 20px;
}

/* Header Styles */
.crypto-header {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius: 20px;
  padding: 40px;
  color: white;
  margin-bottom: 30px;
}

.main-title {
  font-size: 2.5rem;
  font-weight: 700;
  margin-bottom: 10px;
}

.subtitle {
  font-size: 1.2rem;
  opacity: 0.9;
  margin-bottom: 20px;
}

.status-badge {
  padding: 10px 20px;
  border-radius: 20px;
  font-weight: 600;
  font-size: 0.9rem;
  display: inline-block;
  margin: 0 5px;
}

.status-active {
  background: rgba(255, 255, 255, 0.2);
  backdrop-filter: blur(10px);
}

.status-simulated {
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
}

.ml-status {
  background: rgba(255, 255, 255, 0.15);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.3);
}

/* Layout Grid */
.crypto-content-grid {
  display: grid;
  grid-template-columns: 1fr 350px;
  gap: 30px;
}

/* Feature Cards */
.feature-card {
  background: white;
  border-radius: 20px;
  padding: 30px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.1);
  margin-bottom: 25px;
  border: 1px solid #e1e8ed;
}

.card-header {
  display: flex;
  align-items: flex-start;
  gap: 15px;
  margin-bottom: 25px;
}

.card-icon {
  font-size: 2rem;
  color: #667eea;
  margin-top: 5px;
}

.card-title h3 {
  font-size: 1.5rem;
  font-weight: 600;
  margin-bottom: 5px;
  color: #2c3e50;
}

.card-title p {
  color: #7f8c8d;
  margin: 0;
}

/* ML Specific Styles */
.ml-status-card {
  border-left: 4px solid #667eea;
  background: linear-gradient(135deg, #f8f9ff 0%, #f0f2ff 100%);
}

.ml-badge {
  background: linear-gradient(45deg, #667eea, #764ba2);
  color: white;
  padding: 8px 15px;
  border-radius: 20px;
  font-weight: 600;
  font-size: 0.9rem;
  display: flex;
  align-items: center;
  gap: 5px;
}

.ml-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  gap: 20px;
  margin-top: 15px;
}

.ml-metric {
  text-align: center;
  padding: 15px;
  background: #f8f9fa;
  border-radius: 10px;
  border: 1px solid #e1e8ed;
}

.metric-value {
  font-size: 1.5rem;
  font-weight: 700;
  color: #667eea;
  margin-bottom: 5px;
}

.metric-label {
  font-size: 0.85rem;
  color: #7f8c8d;
}

.ml-unavailable {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 15px;
  background: #fff3cd;
  border-radius: 10px;
  color: #856404;
  font-weight: 500;
  border: 1px solid #ffeaa7;
}

.ml-indicator {
  background: #667eea;
  color: white;
  padding: 2px 8px;
  border-radius: 10px;
  font-size: 0.7rem;
  font-weight: 600;
  margin-left: 8px;
}

.ml-flag, .ml-confirm {
  font-size: 0.8rem;
  font-weight: 500;
  margin-left: 8px;
}

.ml-flag {
  color: #dc3545;
}

.ml-confirm {
  color: #28a745;
}

/* Feature Importance */
.feature-importance {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.feature-item {
  display: flex;
  align-items: center;
  gap: 15px;
  padding: 10px;
}

.feature-name {
  flex: 0 0 200px;
  font-weight: 500;
  color: #2c3e50;
  font-size: 0.9rem;
}

.feature-bar {
  flex: 1;
  height: 8px;
  background: #e9ecef;
  border-radius: 4px;
  overflow: hidden;
}

.feature-fill {
  height: 100%;
  background: linear-gradient(90deg, #667eea, #764ba2);
  border-radius: 4px;
  transition: width 0.5s ease;
}

.feature-value {
  flex: 0 0 60px;
  text-align: right;
  font-weight: 600;
  color: #667eea;
  font-size: 0.9rem;
}

/* Form Styles */
.form-grid {
  display: grid;
  gap: 25px;
  margin-bottom: 25px;
}

.form-group {
  display: flex;
  flex-direction: column;
}

.form-label {
  font-weight: 600;
  margin-bottom: 10px;
  color: #2c3e50;
}

.form-control {
  border-radius: 12px;
  border: 2px solid #e1e8ed;
  padding: 12px 16px;
  font-size: 1rem;
  transition: all 0.3s ease;
  color: #2c3e50 !important;
}

.form-control:focus {
  border-color: #667eea;
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
  color: #2c3e50 !important;
}

.form-text {
  font-size: 0.85rem;
  color: #7f8c8d;
  margin-top: 5px;
}

/* Network Options */
.network-options {
  display: grid;
  gap: 10px;
}

.network-option {
  display: flex;
  align-items: center;
  padding: 15px;
  border: 2px solid #e1e8ed;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.network-option:hover {
  border-color: #667eea;
  background: #f8f9fa;
}

.network-option input[type="radio"] {
  margin-right: 12px;
}

.option-title {
  font-weight: 600;
  display: block;
  margin-bottom: 2px;
  color: #2c3e50;
}

.option-desc {
  font-size: 0.9rem;
  color: #7f8c8d;
}

/* Buttons */
.scan-btn {
  width: 100%;
  padding: 16px;
  background: linear-gradient(45deg, #667eea, #764ba2);
  color: white;
  border: none;
  border-radius: 12px;
  font-weight: 600;
  font-size: 1.1rem;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
}

.scan-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
}

/* Real Data Grid */
.real-data-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 20px;
  margin-top: 20px;
}

.data-item {
  display: flex;
  align-items: center;
  gap: 15px;
  padding: 15px;
  background: #f8f9fa;
  border-radius: 12px;
}

.data-icon {
  font-size: 1.5rem;
  color: #667eea;
}

.data-value {
  font-size: 1.3rem;
  font-weight: 700;
  color: #2c3e50;
}

.data-label {
  font-size: 0.9rem;
  color: #7f8c8d;
}

/* Risk Meter */
.risk-metrics {
  margin-top: 20px;
}

.risk-meter {
  height: 12px;
  background: #e9ecef;
  border-radius: 6px;
  margin: 15px 0;
  position: relative;
  overflow: hidden;
}

.meter-fill {
  height: 100%;
  background: linear-gradient(90deg, #28a745, #ffc107, #dc3545);
  border-radius: 6px;
  transition: width 1s ease;
}

.meter-labels {
  display: flex;
  justify-content: space-between;
  font-size: 0.8rem;
  color: #7f8c8d;
  font-weight: 600;
}

.risk-indicators {
  margin-top: 15px;
}

.indicator {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px;
  border-radius: 8px;
  font-weight: 600;
}

.indicator.danger {
  background: rgba(220, 53, 69, 0.1);
  color: #dc3545;
}

.indicator.safe {
  background: rgba(40, 167, 69, 0.1);
  color: #28a745;
}

/* Trends Grid */
.trends-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
  margin: 20px 0;
}

.trend-item {
  display: flex;
  align-items: center;
  gap: 15px;
  padding: 15px;
  background: #f8f9fa;
  border-radius: 12px;
}

.trend-icon {
  font-size: 1.5rem;
}

.trend-title {
  font-weight: 600;
  color: #2c3e50;
  margin-bottom: 2px;
}

.trend-value {
  font-size: 0.9rem;
  color: #7f8c8d;
}

/* Deviations */
.deviations-section {
  margin-top: 25px;
  padding-top: 20px;
  border-top: 1px solid #e1e8ed;
}

.deviations-header {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 15px;
  color: #dc3545;
  font-weight: 600;
}

.deviations-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.deviation-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 8px 12px;
  background: rgba(220, 53, 69, 0.05);
  border-radius: 8px;
  font-size: 0.9rem;
  color: #2c3e50;
}

.deviation-item i {
  font-size: 0.6rem;
  color: #dc3545;
}

/* Recommendations */
.recommendations-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.recommendation-item {
  display: flex;
  align-items: flex-start;
  gap: 12px;
  padding: 12px;
  background: #f8f9fa;
  border-radius: 8px;
  border-left: 4px solid #667eea;
}

.recommendation-icon {
  margin-top: 2px;
  flex-shrink: 0;
}

.recommendation-content {
  flex: 1;
  color: #2c3e50 !important;
  font-weight: 500;
  line-height: 1.5;
}

.recommendation-content * {
  color: #2c3e50 !important;
}

/* Comparison Grid */
.comparison-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 20px;
  margin-top: 20px;
}

.wallet-card {
  background: white;
  border: 2px solid;
  border-radius: 15px;
  padding: 20px;
  transition: all 0.3s ease;
  position: relative;
}

.wallet-card.risk-high { border-color: #dc3545; }
.wallet-card.risk-medium { border-color: #ffc107; }
.wallet-card.risk-low { border-color: #28a745; }

.wallet-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

.wallet-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
}

.wallet-address {
  display: flex;
  align-items: center;
  gap: 8px;
}

.real-badge {
  background: #28a745;
  color: white;
  padding: 2px 8px;
  border-radius: 10px;
  font-size: 0.7rem;
  font-weight: 600;
}

.ml-badge-small {
  background: #667eea;
  color: white;
  padding: 2px 6px;
  border-radius: 8px;
  font-size: 0.6rem;
  font-weight: 600;
}

.wallet-risk {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 4px;
}

.risk-score {
  font-weight: 700;
  font-size: 1.1rem;
  color: #2c3e50;
}

.risk-level {
  padding: 4px 8px;
  border-radius: 8px;
  font-size: 0.8rem;
  font-weight: 600;
}

.risk-level.high { background: #dc3545; color: white; }
.risk-level.medium { background: #ffc107; color: black; }
.risk-level.low { background: #28a745; color: white; }

.wallet-stats {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
  margin-bottom: 10px;
}

.stat {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.stat-label {
  font-size: 0.8rem;
  color: #7f8c8d;
}

.stat-value {
  font-weight: 600;
  color: #2c3e50;
}

.wallet-ml {
  padding-top: 10px;
  border-top: 1px solid #e1e8ed;
}

.ml-confidence {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 0.8rem;
}

.confidence-label {
  color: #7f8c8d;
}

.confidence-value {
  font-weight: 600;
  color: #667eea;
}

/* Sidebar */
.sidebar {
  display: flex;
  flex-direction: column;
  gap: 25px;
}

.sidebar-card {
  background: white;
  border-radius: 15px;
  padding: 25px;
  box-shadow: 0 5px 20px rgba(0,0,0,0.1);
  border: 1px solid #e1e8ed;
}

.sidebar-header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 20px;
}

.sidebar-header i {
  font-size: 1.2rem;
  color: #667eea;
}

.sidebar-header h4 {
  margin: 0;
  color: #2c3e50;
  font-size: 1.1rem;
}

/* ML Status Sidebar */
.ml-status-sidebar {
  background: linear-gradient(135deg, #f8f9ff 0%, #f0f2ff 100%);
  border-left: 4px solid #667eea;
}

.ml-status-content {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.status-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px;
  border-radius: 8px;
  font-size: 0.9rem;
  font-weight: 500;
}

.status-item.success {
  background: rgba(40, 167, 69, 0.1);
  color: #28a745;
}

.status-item.info {
  background: rgba(102, 126, 234, 0.1);
  color: #667eea;
}

/* Actions List */
.actions-list {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.action-btn {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 12px 15px;
  border-radius: 8px;
  text-decoration: none;
  font-weight: 500;
  transition: all 0.3s ease;
  border: 2px solid transparent;
}

.action-btn.primary {
  background: linear-gradient(45deg, #667eea, #764ba2);
  color: white;
}

.action-btn.secondary {
  background: white;
  color: #667eea;
  border-color: #667eea;
}

.action-btn:hover {
  transform: translateY(-2px);
  text-decoration: none;
}

.action-btn.primary:hover {
  color: white;
  box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
}

.action-btn.secondary:hover {
  background: #667eea;
  color: white;
}

/* Checks List */
.checks-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.check-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px;
  background: #f8f9fa;
  border-radius: 8px;
}

.check-wallet {
  display: flex;
  align-items: center;
  gap: 8px;
}

.check-chain {
  background: #667eea;
  color: white;
  padding: 2px 6px;
  border-radius: 6px;
  font-size: 0.7rem;
  font-weight: 600;
}

.check-status {
  display: flex;
  align-items: center;
  gap: 8px;
}

.checks-footer {
  margin-top: 15px;
  padding-top: 15px;
  border-top: 1px solid #e1e8ed;
  text-align: center;
}

/* Tips List */
.tips-list {
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.tip-item {
  display: flex;
  align-items: flex-start;
  gap: 12px;
  padding: 12px;
  background: #f8f9fa;
  border-radius: 8px;
}

.tip-icon {
  font-size: 1rem;
  color: #667eea;
  margin-top: 2px;
}

.tip-content strong {
  display: block;
  margin-bottom: 4px;
  color: #2c3e50;
}

.tip-content p {
  margin: 0;
  font-size: 0.85rem;
  color: #7f8c8d;
}

/* Modern Table */
.table-container {
  overflow-x: auto;
  border-radius: 12px;
  border: 1px solid #e1e8ed;
}

.modern-table {
  width: 100%;
  border-collapse: collapse;
}

.modern-table th {
  background: #f8f9fa;
  padding: 15px;
  text-align: left;
  font-weight: 600;
  color: #2c3e50;
  border-bottom: 1px solid #e1e8ed;
}

.modern-table td {
  padding: 15px;
  border-bottom: 1px solid #e1e8ed;
  color: #2c3e50;
}

.modern-table tr:hover {
  background: #f8f9fa;
}

.wallet-cell {
  font-family: 'Courier New', monospace;
  font-weight: 600;
}

.network-badge {
  background: #667eea;
  color: white;
  padding: 4px 8px;
  border-radius: 6px;
  font-size: 0.8rem;
  font-weight: 600;
}

.risk-badge {
  padding: 6px 12px;
  border-radius: 8px;
  font-size: 0.8rem;
  font-weight: 600;
}

.risk-badge.risk-high { background: #dc3545; color: white; }
.risk-badge.risk-medium { background: #ffc107; color: black; }
.risk-badge.risk-low { background: #28a745; color: white; }

.status-flagged {
  color: #dc3545;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 5px;
}

.status-clean {
  color: #28a745;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 5px;
}

.notes-text {
  color: #7f8c8d;
  font-size: 0.9rem;
}

.date-text {
  color: #7f8c8d;
  font-size: 0.9rem;
}

/* History Actions */
.history-actions {
  margin-left: auto;
}

.btn-danger, .btn-outline-danger {
  border-radius: 6px;
  font-weight: 500;
}

.btn-sm {
  padding: 4px 8px;
  font-size: 0.8rem;
}

/* Responsive Design */
@media (max-width: 968px) {
  .crypto-content-grid {
    grid-template-columns: 1fr;
  }
  
  .main-title {
    font-size: 2rem;
  }
  
  .real-data-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .trends-grid {
    grid-template-columns: 1fr;
  }
  
  .ml-grid {
    grid-template-columns: repeat(3, 1fr);
  }
}

@media (max-width: 768px) {
  .crypto-header {
    padding: 30px 20px;
  }
  
  .feature-card {
    padding: 20px;
  }
  
  .card-header {
    flex-direction: column;
    text-align: center;
    gap: 10px;
  }
  
  .real-data-grid {
    grid-template-columns: 1fr;
  }
  
  .comparison-grid {
    grid-template-columns: 1fr;
  }
  
  .ml-grid {
    grid-template-columns: 1fr;
  }
  
  .feature-name {
    flex: 0 0 150px;
  }
}

@media (max-width: 480px) {
  .crypto-container {
    padding: 10px;
  }
  
  .feature-card {
    padding: 15px;
  }
  
  .wallet-stats {
    grid-template-columns: 1fr;
  }
  
  .feature-name {
    flex: 0 0 120px;
    font-size: 0.8rem;
  }
  
  .feature-value {
    flex: 0 0 50px;
    font-size: 0.8rem;
  }
}
</style>

<!-- Font Awesome for Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
{% endblock %}