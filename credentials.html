<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Credential Security Scanner</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --success-gradient: linear-gradient(135deg, #28a745, #20c997);
      --danger-gradient: linear-gradient(135deg, #dc3545, #e83e8c);
      --warning-gradient: linear-gradient(135deg, #ffc107, #fd7e14);
    }

    body[data-theme="dark"] {
      background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 50%, #16213e 100%);
      color: #f0f0f0;
      min-height: 100vh;
    }
    
    body[data-theme="light"] {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 50%, #dee2e6 100%);
      color: #212529;
      min-height: 100vh;
    }

    .container {
      max-width: 1200px;
      margin-top: 20px;
    }

    /* Header Styles */
    .header-section {
      background: var(--primary-gradient);
      border-radius: 20px;
      padding: 40px;
      color: white;
      margin-bottom: 30px;
      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
    }

    .main-title {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 10px;
    }

    .subtitle {
      font-size: 1.2rem;
      opacity: 0.9;
    }

    /* Card Styles */
    .modern-card {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      transition: all 0.3s ease;
    }

    body[data-theme="light"] .modern-card {
      background: rgba(255, 255, 255, 0.9);
      border: 1px solid rgba(0, 0, 0, 0.1);
    }

    .modern-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
    }

    /* Button Styles */
    .dashboard-btn {
      background: var(--primary-gradient);
      border: none;
      color: white;
      padding: 12px 24px;
      border-radius: 12px;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }

    .dashboard-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
      color: white;
    }

    .theme-toggle {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: white;
      border-radius: 12px;
      padding: 10px 16px;
      transition: all 0.3s ease;
    }

    body[data-theme="light"] .theme-toggle {
      background: rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(0, 0, 0, 0.2);
      color: #212529;
    }

    /* Form Styles */
    .form-control {
      border-radius: 12px;
      border: 2px solid rgba(255, 255, 255, 0.1);
      background: rgba(255, 255, 255, 0.1);
      color: inherit;
      padding: 12px 16px;
      transition: all 0.3s ease;
    }

    body[data-theme="light"] .form-control {
      border: 2px solid rgba(0, 0, 0, 0.1);
      background: rgba(255, 255, 255, 0.8);
    }

    .form-control:focus {
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      background: rgba(255, 255, 255, 0.15);
    }

    .submit-btn {
      background: var(--primary-gradient);
      border: none;
      padding: 14px 30px;
      border-radius: 12px;
      font-weight: 600;
      font-size: 1.1rem;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }

    .submit-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    }

    /* API Status */
    .api-status {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 15px;
      margin: 20px 0;
      border-left: 4px solid;
    }

    .api-status.hibp { border-left-color: #28a745; }
    .api-status.numverify { border-left-color: #ffc107; }
    .api-status.disabled { border-left-color: #6c757d; }

    /* Risk Meter */
    .risk-meter-container {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 15px;
      padding: 25px;
      margin: 20px 0;
    }

    .risk-meter {
      height: 25px;
      border-radius: 12px;
      background: linear-gradient(90deg, #28a745, #ffc107, #dc3545);
      margin: 15px 0;
      position: relative;
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .risk-indicator {
      position: absolute;
      top: -8px;
      width: 40px;
      height: 40px;
      background: white;
      border-radius: 50%;
      border: 4px solid #333;
      transform: translateX(-50%);
      transition: left 1s ease;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    }

    .risk-labels {
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
      font-weight: 600;
    }

    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 20px;
      margin: 25px 0;
    }

    .stat-card {
      background: rgba(255, 255, 255, 0.1);
      padding: 20px;
      border-radius: 15px;
      text-align: center;
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.3s ease;
    }

    .stat-card:hover {
      transform: translateY(-3px);
      background: rgba(255, 255, 255, 0.15);
    }

    .stat-number {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 8px;
      background: var(--primary-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .stat-label {
      font-size: 0.9rem;
      opacity: 0.8;
      font-weight: 500;
    }

    /* Result Items */
    .result-item {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 15px;
      padding: 20px;
      margin: 15px 0;
      border-left: 5px solid;
      transition: all 0.3s ease;
    }

    .result-item.safe {
      border-left-color: #28a745;
      background: rgba(40, 167, 69, 0.1);
    }

    .result-item.warning {
      border-left-color: #ffc107;
      background: rgba(255, 193, 7, 0.1);
    }

    .result-item.danger {
      border-left-color: #dc3545;
      background: rgba(220, 53, 69, 0.1);
    }

    .result-item:hover {
      transform: translateX(5px);
    }

    /* Phone Validation Details */
    .validation-details {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      padding: 15px;
      margin: 15px 0;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .validation-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 10px;
    }

    .validation-item {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .validation-label {
      font-size: 0.85rem;
      color: #ccc;
      font-weight: 600;
    }

    .validation-value {
      font-size: 0.9rem;
      font-weight: 500;
    }

    .risk-factors {
      background: rgba(220, 53, 69, 0.1);
      border-radius: 10px;
      padding: 15px;
      margin: 10px 0;
    }

    .risk-factor-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 5px 0;
      font-size: 0.9rem;
    }

    .risk-factor-item i {
      color: #dc3545;
    }

    /* Breach Details */
    .breach-details {
      background: rgba(220, 53, 69, 0.1);
      border-radius: 15px;
      padding: 20px;
      margin: 20px 0;
      border: 1px solid rgba(220, 53, 69, 0.3);
    }

    .breach-item {
      background: rgba(255, 255, 255, 0.05);
      padding: 18px;
      border-radius: 12px;
      margin: 12px 0;
      border-left: 4px solid #dc3545;
      transition: all 0.3s ease;
    }

    .breach-item:hover {
      transform: translateX(5px);
      background: rgba(255, 255, 255, 0.08);
    }

    .breach-name {
      font-weight: 700;
      color: #ff6b6b;
      font-size: 1.1rem;
      margin-bottom: 8px;
    }

    .breach-meta {
      font-size: 0.9rem;
      color: #ccc;
      margin-bottom: 10px;
    }

    body[data-theme="light"] .breach-meta {
      color: #666;
    }

    .data-classes {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
    }

    .data-class-badge {
      background: rgba(220, 53, 69, 0.3);
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 500;
      border: 1px solid rgba(220, 53, 69, 0.5);
    }

    /* Charts Container */
    .charts-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 25px;
      margin: 25px 0;
    }

    @media (max-width: 768px) {
      .charts-container {
        grid-template-columns: 1fr;
      }
      
      .main-title {
        font-size: 2rem;
      }
      
      .header-section {
        padding: 30px 20px;
      }
      
      .validation-grid {
        grid-template-columns: 1fr;
      }
    }

    /* Security Tips */
    .tips-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .tip-card {
      background: rgba(255, 255, 255, 0.05);
      padding: 20px;
      border-radius: 15px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.3s ease;
    }

    .tip-card:hover {
      transform: translateY(-3px);
      background: rgba(255, 255, 255, 0.08);
    }

    .tip-icon {
      font-size: 2rem;
      margin-bottom: 15px;
      background: var(--primary-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    /* Animations */
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .animate-in {
      animation: slideIn 0.6s ease-out;
    }

    /* Badge Styles */
    .risk-badge {
      padding: 8px 16px;
      border-radius: 20px;
      font-weight: 600;
      font-size: 0.9rem;
    }

    .badge-high { background: var(--danger-gradient); color: white; }
    .badge-medium { background: var(--warning-gradient); color: black; }
    .badge-low { background: var(--success-gradient); color: white; }

    /* Phone-specific styles */
    .phone-risk-score {
      font-size: 1.2rem;
      font-weight: 700;
      margin: 10px 0;
    }

    .risk-breakdown {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
      padding: 15px;
      margin: 10px 0;
    }

    .risk-breakdown-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .risk-breakdown-item:last-child {
      border-bottom: none;
    }
  </style>
</head>
<body data-theme="dark">
  <div class="container">
    <!-- Header Section -->
    <div class="header-section animate-in">
      <div class="row align-items-center">
        <div class="col-md-8">
          <h1 class="main-title">üõ°Ô∏è Credential Security Scanner</h1>
          <p class="subtitle">Advanced security analysis with enhanced phone number validation</p>
        </div>
        <div class="col-md-4 text-end">
          <div class="d-flex gap-3 justify-content-end align-items-center">
            <a href="{{ url_for('dashboard') }}" class="dashboard-btn">
              <i class="fas fa-arrow-left"></i>
              Dashboard
            </a>
            <button class="btn theme-toggle" id="themeToggle">
              <i class="fas fa-moon"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- API Status Indicators -->
    <div class="row mb-4">
      <div class="col-md-6">
        <div class="api-status {% if HIBP_ENABLED %}hibp{% else %}disabled{% endif %} animate-in">
          <div class="d-flex align-items-center">
            <i class="fas fa-shield-alt me-3 fs-4"></i>
            <div>
              <h6 class="mb-1">HIBP API Status</h6>
              <p class="mb-0">
                {% if HIBP_ENABLED %}
                ‚úÖ Active - Email breach detection enabled
                {% else %}
                ‚ö†Ô∏è Disabled - Add API key for real breach data
                {% endif %}
              </p>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="api-status {% if NUMVERIFY_ENABLED %}numverify{% else %}disabled{% endif %} animate-in">
          <div class="d-flex align-items-center">
            <i class="fas fa-phone-alt me-3 fs-4"></i>
            <div>
              <h6 class="mb-1">NumVerify API Status</h6>
              <p class="mb-0">
                {% if NUMVERIFY_ENABLED %}
                ‚úÖ Active - Advanced phone validation enabled
                {% else %}
                ‚ö†Ô∏è Disabled - Using pattern analysis only
                {% endif %}
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Scanner Form -->
    <div class="modern-card p-4 mb-4 animate-in" style="animation-delay: 0.1s;">
      <div class="row align-items-center">
        <div class="col-md-8">
          <h4 class="mb-3"><i class="fas fa-search me-2"></i>Advanced Security Scan</h4>
          <p class="text-muted mb-0">Comprehensive analysis with enhanced phone number validation</p>
        </div>
        <div class="col-md-4 text-end">
          <span class="badge bg-primary px-3 py-2">
            <i class="fas fa-shield-alt me-2"></i>Multi-Layer Security
          </span>
        </div>
      </div>
      
      <form method="POST" class="mt-4">
        <div class="row g-4">
          <div class="col-md-4">
            <label class="form-label fw-bold">üìß Email Address</label>
            <input type="email" class="form-control" name="email" placeholder="your.email@example.com" value="{{ values.email }}">
            <div class="form-text">
              {% if HIBP_ENABLED %}
              ‚úÖ Real-time breach database check
              {% else %}
              ‚ö†Ô∏è Basic validation only
              {% endif %}
            </div>
          </div>
          <div class="col-md-4">
            <label class="form-label fw-bold">üìû Phone Number</label>
            <input type="text" class="form-control" name="phone" placeholder="+1 234 567 8900" value="{{ values.phone }}">
            <div class="form-text">
              {% if NUMVERIFY_ENABLED %}
              ‚úÖ Advanced validation & risk analysis
              {% else %}
              ‚ö†Ô∏è Pattern analysis only
              {% endif %}
            </div>
          </div>
          <div class="col-md-4">
            <label class="form-label fw-bold">üîë Password</label>
            <input type="password" class="form-control" name="password" placeholder="Enter password to check" value="{{ values.password }}">
            <div class="form-text">‚úÖ Checked against known breaches</div>
          </div>
        </div>
        <button type="submit" class="btn submit-btn w-100 mt-4">
          <i class="fas fa-shield-alt me-2"></i>Start Advanced Security Scan
        </button>
      </form>
    </div>

    <!-- Results Section -->
    {% if results %}
    <div class="modern-card p-4 mb-4 animate-in" style="animation-delay: 0.2s;">
      <h4 class="mb-4"><i class="fas fa-chart-bar me-2"></i>Security Analysis Results</h4>
      
      <!-- Risk Assessment -->
      <div class="risk-meter-container">
        <div class="row align-items-center">
          <div class="col-md-8">
            <h5 class="mb-3">Overall Risk Assessment</h5>
            <div class="risk-meter">
              <div class="risk-indicator" id="riskIndicator" style="left: {{ risk_data.risk_percentage }}%;"></div>
            </div>
            <div class="risk-labels">
              <span><i class="fas fa-check-circle text-success me-1"></i>Low</span>
              <span><i class="fas fa-exclamation-triangle text-warning me-1"></i>Medium</span>
              <span><i class="fas fa-times-circle text-danger me-1"></i>High</span>
            </div>
          </div>
          <div class="col-md-4 text-center">
            <div class="display-4 fw-bold mb-2" id="riskScore">{{ risk_data.risk_score }}</div>
            <div id="riskLevel" class="risk-badge"></div>
            <p class="text-muted mt-2 mb-0">Risk Score / 100</p>
          </div>
        </div>
      </div>

      <!-- Statistics -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-number">{{ risk_data.breached }}</div>
          <div class="stat-label">Risky Items</div>
          <small class="text-muted">Requires attention</small>
        </div>
        <div class="stat-card">
          <div class="stat-number">{{ risk_data.safe }}</div>
          <div class="stat-label">Secure Items</div>
          <small class="text-muted">No issues found</small>
        </div>
        <div class="stat-card">
          <div class="stat-number">{{ risk_data.total_checked }}</div>
          <div class="stat-label">Total Scanned</div>
          <small class="text-muted">Items checked</small>
        </div>
        <div class="stat-card">
          <div class="stat-number">{{ risk_data.breach_percentage }}%</div>
          <div class="stat-label">Risk Rate</div>
          <small class="text-muted">Compromised ratio</small>
        </div>
      </div>

      <!-- Detailed Results -->
      <h5 class="mt-5 mb-4"><i class="fas fa-list-alt me-2"></i>Detailed Analysis</h5>
      
      <!-- Email Results -->
      {% if results.email %}
        <div class="result-item {% if results.email.breached %}danger{% else %}safe{% endif %}">
          <div class="row align-items-center">
            <div class="col-md-8">
              <h6 class="mb-2">
                <i class="fas fa-envelope me-2"></i>Email Address
                <span class="text-muted">‚Ä¢ {{ results.email.input }}</span>
              </h6>
              {% if results.email.breached %}
                <p class="mb-2 text-danger">
                  <i class="fas fa-exclamation-triangle me-2"></i>
                  <strong>Found in {{ results.email.breach_count }} data breaches</strong>
                </p>
              {% else %}
                <p class="mb-2 text-success">
                  <i class="fas fa-check-circle me-2"></i>
                  <strong>No breaches detected</strong>
                </p>
              {% endif %}
              <small class="text-muted">{{ results.email.message }}</small>
            </div>
            <div class="col-md-4 text-end">
              {% if results.email.breached %}
                <span class="badge bg-danger px-3 py-2">
                  <i class="fas fa-times me-1"></i>Compromised
                </span>
              {% else %}
                <span class="badge bg-success px-3 py-2">
                  <i class="fas fa-check me-1"></i>Secure
                </span>
              {% endif %}
            </div>
          </div>

          <!-- Breach Details -->
          {% if results.email.breached and results.email.breach_details %}
          <div class="breach-details mt-3">
            <h6 class="mb-3"><i class="fas fa-database me-2"></i>Breach Details ({{ results.email.breach_count }} found)</h6>
            {% for breach in results.email.breach_details %}
            <div class="breach-item">
              <div class="breach-name">
                <i class="fas fa-exclamation-circle me-2"></i>{{ breach.title }}
                {% if breach.domain %}<small class="text-muted">({{ breach.domain }})</small>{% endif %}
              </div>
              <div class="breach-meta">
                <i class="fas fa-calendar me-1"></i>{{ breach.breach_date }} ‚Ä¢ 
                <i class="fas fa-users me-1"></i>{{ breach.pwn_count|format_number }} accounts ‚Ä¢
                {% if breach.is_verified %}<span class="badge bg-success me-2">Verified</span>{% endif %}
                {% if breach.is_sensitive %}<span class="badge bg-warning">Sensitive</span>{% endif %}
              </div>
              {% if breach.data_classes %}
              <div class="mt-2">
                <strong>Compromised Data:</strong>
                <div class="data-classes mt-1">
                  {% for data_class in breach.data_classes[:6] %}
                  <span class="data-class-badge">{{ data_class }}</span>
                  {% endfor %}
                  {% if breach.data_classes|length > 6 %}
                  <span class="data-class-badge">+{{ breach.data_classes|length - 6 }} more</span>
                  {% endif %}
                </div>
              </div>
              {% endif %}
            </div>
            {% endfor %}
          </div>
          {% endif %}
        </div>
      {% endif %}

      <!-- Phone Results - ENHANCED SECTION -->
      {% if results.phone %}
        <div class="result-item {% if results.phone.breached %}danger{% elif results.phone.risk_data.risk_level == 'Medium' %}warning{% else %}safe{% endif %}">
          <div class="row align-items-center">
            <div class="col-md-8">
              <h6 class="mb-2">
                <i class="fas fa-phone me-2"></i>Phone Number
                <span class="text-muted">‚Ä¢ {{ results.phone.input }}</span>
              </h6>
              
              {% if results.phone.breached %}
                <p class="mb-2 text-danger">
                  <i class="fas fa-exclamation-triangle me-2"></i>
                  <strong>üö® FLAGGED: {{ results.phone.risk_data.risk_level }} Risk Phone Number</strong>
                </p>
              {% else %}
                <p class="mb-2 text-success">
                  <i class="fas fa-check-circle me-2"></i>
                  <strong>‚úÖ Phone Number Validated - {{ results.phone.risk_data.risk_level }} Risk</strong>
                </p>
              {% endif %}
              
              <small class="text-muted">{{ results.phone.message }}</small>
              
              <!-- Phone Risk Score -->
              <div class="phone-risk-score mt-2">
                Risk Score: <strong>{{ results.phone.risk_data.risk_score }}/10</strong>
              </div>
            </div>
            <div class="col-md-4 text-end">
              {% if results.phone.breached %}
                <span class="badge bg-danger px-3 py-2">
                  <i class="fas fa-flag me-1"></i>High Risk
                </span>
              {% elif results.phone.risk_data.risk_level == 'Medium' %}
                <span class="badge bg-warning px-3 py-2">
                  <i class="fas fa-exclamation me-1"></i>Medium Risk
                </span>
              {% else %}
                <span class="badge bg-success px-3 py-2">
                  <i class="fas fa-check me-1"></i>Low Risk
                </span>
              {% endif %}
            </div>
          </div>

          <!-- Enhanced Phone Validation Details -->
          {% if results.phone.validation_data %}
          <div class="validation-details mt-3">
            <h6 class="mb-3"><i class="fas fa-info-circle me-2"></i>Phone Validation Details</h6>
            <div class="validation-grid">
              <div class="validation-item">
                <span class="validation-label">Number Type</span>
                <span class="validation-value text-capitalize">
                  {{ results.phone.validation_data.line_type or 'Unknown' }}
                  {% if results.phone.validation_data.line_type == 'voip' %}
                  <i class="fas fa-exclamation-triangle text-warning ms-1" title="VOIP numbers may be higher risk"></i>
                  {% endif %}
                </span>
              </div>
              <div class="validation-item">
                <span class="validation-label">Carrier</span>
                <span class="validation-value">{{ results.phone.validation_data.carrier or 'Unknown' }}</span>
              </div>
              <div class="validation-item">
                <span class="validation-label">Location</span>
                <span class="validation-value">{{ results.phone.validation_data.location or 'Unknown' }}</span>
              </div>
              <div class="validation-item">
                <span class="validation-label">Country</span>
                <span class="validation-value">{{ results.phone.validation_data.country or 'Unknown' }}</span>
              </div>
            </div>
          </div>
          {% endif %}

          <!-- Risk Factors -->
          {% if results.phone.risk_data.risk_factors %}
          <div class="risk-factors mt-3">
            <h6 class="mb-2"><i class="fas fa-exclamation-triangle me-2"></i>Risk Factors Detected</h6>
            {% for factor in results.phone.risk_data.risk_factors %}
            <div class="risk-factor-item">
              <i class="fas fa-circle fa-xs"></i>
              <span>{{ factor }}</span>
            </div>
            {% endfor %}
          </div>
          {% endif %}

          <!-- Risk Breakdown -->
          <div class="risk-breakdown mt-3">
            <h6 class="mb-3"><i class="fas fa-chart-pie me-2"></i>Risk Assessment Breakdown</h6>
            <div class="risk-breakdown-item">
              <span>Pattern Analysis</span>
              <span class="badge bg-secondary">{{ results.phone.risk_data.risk_score }}/10</span>
            </div>
            {% if results.phone.validation_data %}
            <div class="risk-breakdown-item">
              <span>Number Validation</span>
              <span class="badge bg-{% if results.phone.validation_data.valid %}success{% else %}warning{% endif %}">
                {% if results.phone.validation_data.valid %}Valid{% else %}Invalid{% endif %}
              </span>
            </div>
            <div class="risk-breakdown-item">
              <span>Line Type</span>
              <span class="badge bg-{% if results.phone.validation_data.line_type == 'voip' %}warning{% else %}info{% endif %}">
                {{ results.phone.validation_data.line_type|title }}
              </span>
            </div>
            {% endif %}
          </div>
        </div>
      {% endif %}

      <!-- Password Results -->
      {% if results.password %}
        <div class="result-item {% if results.password.pwned %}danger{% else %}safe{% endif %}">
          <div class="row align-items-center">
            <div class="col-md-8">
              <h6 class="mb-2">
                <i class="fas fa-key me-2"></i>Password Security
              </h6>
              {% if results.password.pwned %}
                <p class="mb-2 text-danger">
                  <i class="fas fa-exclamation-triangle me-2"></i>
                  <strong>Password exposed {{ results.password.count }} times</strong>
                </p>
                <small class="text-muted">This password appears in known data breaches</small>
              {% else %}
                <p class="mb-2 text-success">
                  <i class="fas fa-check-circle me-2"></i>
                  <strong>Password not found in breaches</strong>
                </p>
                <small class="text-muted">No matches in our breach database</small>
              {% endif %}
            </div>
            <div class="col-md-4 text-end">
              {% if results.password.pwned %}
                <span class="badge bg-danger px-3 py-2">
                  <i class="fas fa-times me-1"></i>Compromised
                </span>
              {% else %}
                <span class="badge bg-success px-3 py-2">
                  <i class="fas fa-check me-1"></i>Secure
                </span>
              {% endif %}
            </div>
          </div>
        </div>
      {% endif %}
    </div>

    <!-- Security Charts -->
    <div class="modern-card p-4 mb-4 animate-in" style="animation-delay: 0.3s;">
      <h5 class="mb-4"><i class="fas fa-chart-pie me-2"></i>Security Overview</h5>
      <div class="charts-container">
        <div>
          <canvas id="riskChart" width="400" height="250"></canvas>
        </div>
        <div>
          <canvas id="breachChart" width="400" height="250"></canvas>
        </div>
      </div>
      <div class="text-center mt-4">
        <div class="d-flex justify-content-center gap-4 flex-wrap">
          <span class="badge bg-danger px-3 py-2">
            <i class="fas fa-times me-1"></i>Risky: {{ risk_data.breached }}
          </span>
          <span class="badge bg-success px-3 py-2">
            <i class="fas fa-check me-1"></i>Secure: {{ risk_data.safe }}
          </span>
          <span class="badge bg-primary px-3 py-2">
            <i class="fas fa-list me-1"></i>Total: {{ risk_data.total_checked }}
          </span>
        </div>
        <p class="text-muted mt-3 mb-0">
          <i class="fas fa-sync-alt me-1"></i>Last scanned: Just now
        </p>
      </div>
    </div>
    {% endif %}

    <!-- Security Recommendations -->
    <div class="modern-card p-4 animate-in" style="animation-delay: 0.4s;">
      <h5 class="mb-4"><i class="fas fa-lightbulb me-2"></i>Security Recommendations</h5>
      <div class="tips-grid">
        <div class="tip-card">
          <div class="tip-icon">
            <i class="fas fa-user-lock"></i>
          </div>
          <h6>Password Security</h6>
          <p class="mb-0">Use unique, complex passwords for each account and enable two-factor authentication wherever possible.</p>
        </div>
        <div class="tip-card">
          <div class="tip-icon">
            <i class="fas fa-shield-alt"></i>
          </div>
          <h6>Email Protection</h6>
          <p class="mb-0">Monitor your email in breach databases regularly and use aliases for different services.</p>
        </div>
        <div class="tip-card">
          <div class="tip-icon">
            <i class="fas fa-phone-slash"></i>
          </div>
          <h6>Phone Security</h6>
          <p class="mb-0">Avoid using VOIP numbers for sensitive accounts and be cautious of unknown callers.</p>
        </div>
        <div class="tip-card">
          <div class="tip-icon">
            <i class="fas fa-sync-alt"></i>
          </div>
          <h6>Regular Monitoring</h6>
          <p class="mb-0">Scan your credentials periodically and update passwords after major breaches.</p>
        </div>
      </div>
      
      <div class="mt-4 p-3 bg-primary bg-opacity-10 rounded-3">
        <h6><i class="fas fa-exclamation-triangle me-2"></i>Immediate Actions Required</h6>
        <ul class="mb-0">
          {% if results and risk_data and risk_data.breached > 0 %}
          <li>Change passwords for any compromised credentials immediately</li>
          <li>Enable two-factor authentication on all critical accounts</li>
          <li>Monitor financial statements for suspicious activity</li>
          <li>Consider using a password manager for better security</li>
          {% else %}
          <li>Continue regular security monitoring practices</li>
          <li>Consider using our AI password generator for stronger credentials</li>
          <li>Enable two-factor authentication where available</li>
          <li>Stay vigilant against phishing attempts</li>
          {% endif %}
        </ul>
      </div>
    </div>
  </div>

  <!-- JavaScript for Interactive Elements -->
  <script>
    // Theme Toggle
    document.getElementById('themeToggle').addEventListener('click', function() {
      const currentTheme = document.body.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      document.body.setAttribute('data-theme', newTheme);
      
      const icon = this.querySelector('i');
      icon.className = newTheme === 'dark' ? 'fas fa-moon' : 'fas fa-sun';
      
      // Save theme preference
      localStorage.setItem('theme', newTheme);
    });

    // Load saved theme
    const savedTheme = localStorage.getItem('theme') || 'dark';
    document.body.setAttribute('data-theme', savedTheme);
    const themeIcon = document.querySelector('#themeToggle i');
    themeIcon.className = savedTheme === 'dark' ? 'fas fa-moon' : 'fas fa-sun';

    // Risk Indicator Animation
    function animateRiskIndicator() {
      const indicator = document.getElementById('riskIndicator');
      if (indicator) {
        // Reset for animation
        indicator.style.transition = 'none';
        indicator.style.left = '0%';
        
        setTimeout(() => {
          indicator.style.transition = 'left 1.5s ease-in-out';
          const targetPosition = indicator.style.left;
          indicator.style.left = '0%';
          
          setTimeout(() => {
            indicator.style.left = targetPosition;
          }, 100);
        }, 500);
      }
    }

    // Update Risk Badge
    function updateRiskBadge() {
      const riskScore = document.getElementById('riskScore');
      const riskLevel = document.getElementById('riskLevel');
      
      if (riskScore && riskLevel) {
        const score = parseInt(riskScore.textContent);
        let badgeClass, badgeText;
        
        if (score >= 70) {
          badgeClass = 'badge-high';
          badgeText = 'HIGH RISK';
        } else if (score >= 40) {
          badgeClass = 'badge-medium';
          badgeText = 'MEDIUM RISK';
        } else {
          badgeClass = 'badge-low';
          badgeText = 'LOW RISK';
        }
        
        riskLevel.className = `risk-badge ${badgeClass}`;
        riskLevel.textContent = badgeText;
      }
    }

    // Initialize Charts
    function initializeCharts() {
      const riskCtx = document.getElementById('riskChart');
      const breachCtx = document.getElementById('breachChart');
      
      if (!riskCtx || !breachCtx) return;
      
      // Risk Distribution Chart
      const riskChart = new Chart(riskCtx, {
        type: 'doughnut',
        data: {
          labels: ['Low Risk', 'Medium Risk', 'High Risk'],
          datasets: [{
            data: [{{ risk_data.safe if risk_data else 0 }}, 
                   {{ (risk_data.total_checked - risk_data.safe - risk_data.breached) if risk_data else 0 }}, 
                   {{ risk_data.breached if risk_data else 0 }}],
            backgroundColor: ['#28a745', '#ffc107', '#dc3545'],
            borderWidth: 2,
            borderColor: document.body.getAttribute('data-theme') === 'dark' ? '#1a1a2e' : '#ffffff'
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                color: document.body.getAttribute('data-theme') === 'dark' ? '#f0f0f0' : '#212529',
                font: {
                  size: 12
                }
              }
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  const label = context.label || '';
                  const value = context.raw || 0;
                  const total = context.dataset.data.reduce((a, b) => a + b, 0);
                  const percentage = total > 0 ? Math.round((value / total) * 100) : 0;
                  return `${label}: ${value} (${percentage}%)`;
                }
              }
            }
          }
        }
      });
      
      // Breach Status Chart
      const breachChart = new Chart(breachCtx, {
        type: 'bar',
        data: {
          labels: ['Secure', 'Risky'],
          datasets: [{
            label: 'Items',
            data: [{{ risk_data.safe if risk_data else 0 }}, {{ risk_data.breached if risk_data else 0 }}],
            backgroundColor: ['#28a745', '#dc3545'],
            borderWidth: 1,
            borderRadius: 8
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              display: false
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                color: document.body.getAttribute('data-theme') === 'dark' ? '#f0f0f0' : '#212529'
              },
              grid: {
                color: document.body.getAttribute('data-theme') === 'dark' ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)'
              }
            },
            x: {
              ticks: {
                color: document.body.getAttribute('data-theme') === 'dark' ? '#f0f0f0' : '#212529'
              },
              grid: {
                display: false
              }
            }
          }
        }
      });
      
      // Update charts on theme change
      const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
          if (mutation.attributeName === 'data-theme') {
            riskChart.update();
            breachChart.update();
          }
        });
      });
      
      observer.observe(document.body, {
        attributes: true
      });
    }

    // Form Validation
    function validateForm() {
      const email = document.querySelector('input[name="email"]');
      const phone = document.querySelector('input[name="phone"]');
      const password = document.querySelector('input[name="password"]');
      let isValid = false;
      
      if (email && email.value.trim() !== '') {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email.value)) {
          alert('Please enter a valid email address');
          return false;
        }
        isValid = true;
      }
      
      if (phone && phone.value.trim() !== '') {
        const phoneRegex = /^\+?[\d\s\-\(\)]{10,}$/;
        if (!phoneRegex.test(phone.value)) {
          alert('Please enter a valid phone number (at least 10 digits)');
          return false;
        }
        isValid = true;
      }
      
      if (password && password.value.trim() !== '') {
        if (password.value.length < 4) {
          alert('Password should be at least 4 characters long');
          return false;
        }
        isValid = true;
      }
      
      if (!isValid) {
        alert('Please enter at least one credential to scan');
        return false;
      }
      
      return true;
    }

    // Add form validation
    document.querySelector('form')?.addEventListener('submit', function(e) {
      if (!validateForm()) {
        e.preventDefault();
      }
    });

    // Initialize everything when DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
      animateRiskIndicator();
      updateRiskBadge();
      initializeCharts();
      
      // Add smooth scrolling for anchor links
      document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
          e.preventDefault();
          const target = document.querySelector(this.getAttribute('href'));
          if (target) {
            target.scrollIntoView({
              behavior: 'smooth',
              block: 'start'
            });
          }
        });
      });
    });

    // Enhanced risk indicator with pulse animation for high risk
    function enhanceRiskVisuals() {
      const riskScore = {{ risk_data.risk_score if risk_data else 0 }};
      const riskIndicator = document.getElementById('riskIndicator');
      
      if (riskIndicator && riskScore >= 70) {
        riskIndicator.style.animation = 'pulse 2s infinite';
        
        // Add CSS for pulse animation
        const style = document.createElement('style');
        style.textContent = `
          @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(220, 53, 69, 0); }
            100% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0); }
          }
        `;
        document.head.appendChild(style);
      }
    }

    // Call enhanced visuals
    enhanceRiskVisuals();
  </script>
</body>
</html>